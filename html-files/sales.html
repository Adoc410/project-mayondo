<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MWF Sales</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-image: url('pic/lamp.gif'); /* same background */
      background-size: cover;
      background-position: center;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .sales-section {
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      width: 90%;
      max-width: 850px;
      animation: fadeIn 1.5s ease;
    }

    h1 {
      text-align: center;
      color: #9c27b0;
      margin-bottom: 10px;
    }

    #welcome {
      text-align: center;
      margin-bottom: 15px;
      font-weight: bold;
      color: #444;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    th {
      background: #9c27b0;
      color: white;
    }

    tr:nth-child(even) {
      background: #f9f9f9;
    }

    button {
      padding: 8px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    #addBtn {
      background: purple;
      color: white;
    }

    .deleteBtn {
      background: crimson;
      color: white;
    }

    .logout {
      background: gray;
      color: white;
      width: 100%;
      margin-top: 10px;
    }

    #addSaleSection {
      text-align: center;
      margin-bottom: 15px;
    }

    #addSaleSection input {
      padding: 8px;
      margin: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }
  </style>
</head>
<body>
  <nav style="background:#5A4DAF; padding:10px;">
  <a href="home.html" style="color:white; margin-right:15px;">Home</a>
  <a href="index.html" style="color:white; margin-right:15px;">Login</a>
  <a href="dash.html" style="color:white; margin-right:15px;">Dashboard</a>
  <a href="admin.html" style="color:white; margin-right:15px;">Admin</a>
  <a href="wk.html" style="color:white; margin-right:15px;">Workers</a>
  <a href="user.html" style="color:white; margin-right:15px;">Users</a>
  <a href="sales.html" style="color:white; margin-right:15px;">Sales</a>
  <a href="product.html" style="color:white; margin-right:15px;">Products</a>
  <a href="invent.html" style="color:white; margin-right:15px;">Inventory</a>
  <a href="todo.html" style="color:white; margin-right:15px;">To-Do</a>
  <a href="cart.html" style="color:white; margin-right:15px;">Cart</a>
  <a href="attend.html" style="color:white; margin-right:15px;">Attendance</a>
  <a href="surv.html" style="color:white; margin-right:15px;">Survey</a>
</nav>

  <section class="sales-section">
    <h1> Sales Management</h1>
    <p id="welcome"></p>
    
    <table id="salesTable">
      <thead>
        <tr>
          <th>Product</th>
          <th>Quantity Sold</th>
          <th>Total ($)</th>
          <th id="actionCol">Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows will load here -->
      </tbody>
    </table>

    <!-- Only for Manager & CEO -->
    <div id="addSaleSection">
      <h3 style="color:#652570;">Record New Sale</h3>
      <input type="text" id="saleProduct" placeholder="Product name">
      <input type="number" id="saleQty" placeholder="Quantity">
      <input type="number" id="saleTotal" placeholder="Total Price">
      <button id="addBtn">Add Sale</button>
    </div>

    <button id="logoutBtn" class="logout">Logout</button>
  </section>

  <script>
    const salesTable = document.querySelector("#salesTable tbody");
    const addSaleSection = document.getElementById("addSaleSection");
    const addBtn = document.getElementById("addBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const welcomeMsg = document.getElementById("welcome");

    // Get logged user & role
    const username = localStorage.getItem("loggedInUser");
    const role = localStorage.getItem("userRole");

    if (!username || !role) {
      window.location.href = "login.html"; // redirect if not logged in
    }

    welcomeMsg.textContent = `Welcome ${username} (${role})`;

    // Default sales data
    let sales = JSON.parse(localStorage.getItem("sales")) || [
      { product: "Chair", qty: 5, total: 125 },
      { product: "Table", qty: 2, total: 160 },
      { product: "Wardrobe", qty: 1, total: 150 }
    ];

    // Render sales
    function renderSales() {
      salesTable.innerHTML = "";
      sales.forEach((sale, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${sale.product}</td>
          <td>${sale.qty}</td>
          <td>${sale.total}</td>
          ${
            role === "Manager" || role === "CEO"
              ? `<td><button class="deleteBtn" onclick="deleteSale(${index})">Delete</button></td>`
              : `<td>View Only</td>`
          }
        `;
        salesTable.appendChild(row);
      });
      localStorage.setItem("sales", JSON.stringify(sales));
    }

    // Add new sale (Manager & CEO only)
    if (role === "Worker") {
      addSaleSection.style.display = "none";
      document.getElementById("actionCol").style.display = "none";
    } else {
      addBtn.addEventListener("click", () => {
        const product = document.getElementById("saleProduct").value.trim();
        const qty = parseInt(document.getElementById("saleQty").value);
        const total = parseFloat(document.getElementById("saleTotal").value);

        if (product === "" || isNaN(qty) || isNaN(total)) {
          alert("Please enter valid sale details.");
          return;
        }

        sales.push({ product, qty, total });
        renderSales();

        document.getElementById("saleProduct").value = "";
        document.getElementById("saleQty").value = "";
        document.getElementById("saleTotal").value = "";
      });
    }

    // Delete sale
    function deleteSale(index) {
      sales.splice(index, 1);
      renderSales();
    }
    window.deleteSale = deleteSale;

    // Logout
    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("loggedInUser");
      localStorage.removeItem("userRole");
      window.location.href = "login.html";
    });

    // Initial render
    renderSales();
  </script>
</body>
</html>
